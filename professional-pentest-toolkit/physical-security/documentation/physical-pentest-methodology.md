# Methodologie de Physical Security Testing

Guide professionnel pour evaluations de securite physique dans le cadre de tests d'intrusion autorises.

## Table des Matieres

1. [Introduction](#introduction)
2. [Cadre Legal et Autorisation](#cadre-legal-et-autorisation)
3. [Phases du Test](#phases-du-test)
4. [Techniques et Outils](#techniques-et-outils)
5. [Reporting](#reporting)
6. [Defenses](#defenses)

---

## Introduction

### Qu'est-ce que le Physical Security Testing?

Evaluation de la securite physique d'une organisation incluant:
- Controles d'acces physique
- Securite des postes de travail
- Protection contre les dispositifs USB malveillants
- Procedures de securite du personnel
- Gestion des visiteurs

### Objectifs

- Identifier vulnerabilites de securite physique
- Evaluer l'efficacite des controles existants
- Tester la sensibilisation du personnel
- Fournir recommandations d'amelioration

### Scope Typique

Un engagement de physical security peut inclure:
- Tests d'acces non autorise aux batiments
- Evaluation de la securite des postes de travail
- Tests de dispositifs HID (USB attacks)
- Social engineering (si autorise)
- Evaluation des cameras et systemes de surveillance

---

## Cadre Legal et Autorisation

### Documentation Requise

**Avant tout engagement, vous DEVEZ obtenir:**

1. **Contrat Signe** incluant explicitement:
   ```
   - "Physical security testing is authorized"
   - Liste des batiments/etages autorises
   - Periode de test precise
   - Heures autorisees (business hours vs. after hours)
   - Techniques autorisees (lock picking, social engineering, etc.)
   - Personnes a contacter en cas d'incident
   ```

2. **Letter of Authorization** (recommandee)
   - Document a porter sur soi
   - Signe par autorite competente
   - Contacts d'urgence
   - Numero de reference de l'engagement

3. **Non-Disclosure Agreement**
   - Protection des informations sensibles
   - Confidentialite des resultats

### Exemple de Clause Contractuelle

```
PHYSICAL SECURITY TESTING AUTHORIZATION

The Client authorizes [Your Company] to conduct physical security
testing at the following locations during the period specified:

Authorized Locations:
- Building A, 123 Main Street, Floors 1-3
- Building B, 456 Oak Avenue, All floors

Authorized Period:
- Start: January 15, 2024
- End: January 19, 2024
- Hours: Monday-Friday, 9 AM - 6 PM

Authorized Techniques:
- Tailgating attempts
- USB HID device testing on unattended workstations
- Unlocked workstation assessment
- Social engineering (pretexting as vendor)

NOT Authorized:
- Lock picking or forced entry
- Access to executive floor (Building A, Floor 4)
- After-hours testing
- Interaction with production systems

Emergency Contacts:
- Primary: John Doe, CISO - john.doe@client.com - +1-555-0100
- Secondary: Jane Smith, Security Manager - jane.smith@client.com - +1-555-0101

Engagement Reference: PHYS-SEC-2024-001
```

### Lois Applicables

**France:**
- Code Penal Art. 323-1 a 323-7
- Violation de domicile (Art. 226-4)
- Autorisation ecrite = protection legale

**USA:**
- Computer Fraud and Abuse Act (CFAA)
- State trespassing laws
- Authorization = defense

---

## Phases du Test

### Phase 1: Pre-Engagement

#### 1.1 Scope Definition

**Questions a poser au client:**
- Quels batiments/zones sont dans le scope?
- Quelles zones sont HORS scope? (salles serveurs critiques, etc.)
- Quels horaires sont autorises?
- Le personnel de securite est-il informe?
- Social engineering est-il autorise?
- Lock picking est-il autorise?

#### 1.2 Reconnaissance

**Reconnaissance Passive:**
- Google Maps / Street View
- Images publiques du batiment
- Reseaux sociaux (LinkedIn pour employes)
- Horaires d'ouverture
- Procedures visiteurs (si publiques)

**Informations a collecter:**
- Points d'entree/sortie
- Presence de cameras
- Type de badges/controles d'acces
- Zones fumeurs (souvent sans badge requis)
- Quais de livraison
- Personnel de securite (nombre, emplacements)

#### 1.3 Preparation

**Materiel:**
- [ ] Badge/Letter of authorization
- [ ] Dispositifs HID (Flipper Zero, Rubber Ducky)
- [ ] Camera discrete (si autorise)
- [ ] Notebook pour documentation
- [ ] Telephone avec contacts d'urgence
- [ ] Vetements appropries (business casual, uniform si pretexting)
- [ ] Materiel de pretexting si necessaire

**Briefing Interne:**
- Objectifs precis
- Rules of engagement
- Procedures d'escalade
- Que faire si interpelle
- Communication avec le client

### Phase 2: Execution

#### 2.1 Access Control Testing

**Objectifs:**
- Tester les controles d'acces physique
- Identifier points faibles
- Evaluer procedures de gestion des visiteurs

**Techniques:**

**Tailgating/Piggybacking**
```
Scenario 1: Suivre un employe legitime
- Approcher avec mains pleines (cafe, boites)
- Attendre qu'un employe ouvre la porte
- Suivre en remerciant

Scenario 2: Pretexting (si autorise)
- Se faire passer pour livreur
- Technicien maintenance
- Nouveau consultant
```

**Badge Cloning** (equipement specialise requis)
- Si autorise explicitement
- RFID/NFC badge cloning
- Necessite equipement legal

**Social Engineering**
```
Pretexts courants:
- "J'ai oublie mon badge"
- "Je suis nouveau, on m'attend au 3e etage"
- "Livraison urgente pour M. Dupont"
- "Technicien pour maintenance reseau"
```

#### 2.2 Workstation Security Testing

**Objectifs:**
- Evaluer securite des postes non surveilles
- Tester vulnerabilite aux attaques HID
- Verifier auto-lock settings

**Procedure:**

1. **Identifier Cibles**
   - Postes non surveilles
   - Ecrans deverrouilles
   - USB ports accessibles

2. **Documentation Initiale**
   ```bash
   python utilities/engagement-logger.py --log "Unlocked workstation identified" \
       --category physical-security \
       --target "Building A, Floor 2, Desk near window" \
       --details "Screen unlocked, user absent, USB ports accessible"
   ```

3. **Test HID (si autorise)**
   - Brancher dispositif HID
   - Executer script de diagnostic
   - Chronometrer le test
   - Documenter resultats

4. **Nettoyage**
   - Supprimer fichiers crees
   - Deconnecter dispositif
   - Laisser workstation dans etat initial

**Timeline Typique:**
```
- Approche: 5-10 secondes
- Branchement HID: 2-3 secondes
- Execution script: 30-60 secondes
- Collecte info: 10-20 secondes
- Nettoyage: 5-10 secondes
---
Total: ~1-2 minutes
```

#### 2.3 USB Port Security

**Tests:**
- USB ports actifs sur workstations
- USB charging stations (data lines actives?)
- Printers avec ports USB
- Conference rooms

**Script HID Test:**
```
Flipper Zero Script:
1. Brancher sur port USB
2. Script ouvre terminal
3. Execute commande basique (hostname, whoami)
4. Collecte output
5. Cleanup
```

#### 2.4 Sensitive Area Access

**Objectifs:**
- Tester acces aux zones sensibles
- Server rooms
- Executive offices
- Data centers

**Approche:**
- Toujours avec autorisation explicite
- Tenter acces normal
- Observer si challenge par personnel
- Documenter controles (badges, biommetrie, etc.)

### Phase 3: Post-Test

#### 3.1 Debriefing Immediat

**Avec le contact client:**
- Findings critiques
- Incidents eventuels
- Anomalies observees

#### 3.2 Cleanup

- [ ] Recuperer tous les dispositifs
- [ ] Verifier aucun fichier laisse
- [ ] Confirmer pas d'impact sur systemes

#### 3.3 Documentation

**Pour chaque finding:**
- Location precise
- Timestamp
- Description detaillee
- Photos (si autorise)
- Impact potentiel
- Recommandations

---

## Techniques et Outils

### Dispositifs HID

#### Flipper Zero

**Avantages:**
- Multi-usage (RFID, IR, GPIO, etc.)
- Interface simple
- Communaute active
- Portable

**Scripts Utiles:**
- Voir: `hid-scripts/flipper-zero/`

**Configuration:**
```
1. Copier script .txt sur SD card
2. Navigation: Bad USB
3. Selectionner script
4. Brancher Flipper en USB
5. Executer script
```

#### USB Rubber Ducky

**Avantages:**
- Tres rapide
- Discret (ressemble a cle USB)
- Simple a utiliser

**Programmation:**
```
1. Ecrire Ducky Script (.txt)
2. Encoder en inject.bin
3. Copier sur microSD
4. Brancher Rubber Ducky
```

**Exemple Ducky Script:**
```
DELAY 1000
GUI r
DELAY 500
STRING cmd
ENTER
DELAY 1000
STRING systeminfo > %TEMP%\info.txt
ENTER
```

#### Bash Bunny

**Avantages:**
- Peut agir comme storage ET HID
- Payloads multiples
- LED indicators

**Moins discret mais plus puissant**

### Lock Picking (Uniquement si Autorise)

**Outils:**
- Lock pick set
- Tension wrench
- Bypass tools

**Legal:**
- JAMAIS sans autorisation explicite
- Peut etre illegal meme avec autorisation selon juridiction
- Verifier lois locales

### Badge Cloning

**Outils:**
- Proxmark3
- Chameleon Mini
- Flipper Zero (RFID)

**Legal:**
- Uniquement avec autorisation explicite
- Cloner uniquement badges de test fournis par client
- Ne JAMAIS cloner badges employes sans leur consentement

---

## Reporting

### Structure du Rapport

#### Executive Summary

```markdown
During the physical security assessment of [Client] facilities,
the testing team identified [X] findings ranging from Low to Critical
severity.

Key Findings:
- Tailgating successful in 8/10 attempts
- 15 unlocked workstations vulnerable to HID attacks
- USB ports uncontrolled on 95% of workstations
- No challenge from security personnel during testing

Overall Risk: HIGH

Immediate actions recommended:
1. Implement automatic screen lock (5 min)
2. Disable USB ports via Group Policy
3. Security awareness training
4. Review access control procedures
```

#### Findings Detailles

**Template par Finding:**

```markdown
## Finding: Unattended Workstations Vulnerable to HID Attacks

**Severity:** HIGH (CVSS 7.5)

**Location:** Building A, Floor 2

**Description:**
During testing on January 16, 2024, between 10:00-12:00, the team
identified 15 unlocked and unattended workstations. Using an authorized
HID device (Flipper Zero), the team successfully:

1. Accessed workstation without authentication
2. Opened terminal via automated keystrokes
3. Executed system enumeration commands
4. Collected system information

**Timeline:**
- Detection of unlocked workstation: 10 seconds
- HID device connection: 3 seconds
- Script execution: 45 seconds
- Information collection: 15 seconds
- Total: ~75 seconds

**Impact:**
An attacker with brief physical access could:
- Install malware/backdoors
- Exfiltrate sensitive data
- Create unauthorized user accounts
- Establish persistent access
- Pivot to network resources

**Affected Systems:**
- 15 workstations in Finance department
- All running Windows 10
- No endpoint detection solutions observed
- USB ports fully functional

**Evidence:**
[Include screenshots/photos if authorized]

**Proof of Concept:**
See Appendix A - HID Script Used
See Appendix B - System Information Collected

**Remediation:**

**Priority 1 (Immediate):**
- Enforce automatic screen lock after 5 minutes of inactivity
  ```
  Group Policy:
  Computer Configuration > Windows Settings > Security Settings >
  Local Policies > Security Options >
  Interactive logon: Machine inactivity limit = 300 seconds
  ```

**Priority 2 (Short-term):**
- Disable USB storage via Group Policy
  ```
  Computer Configuration > Administrative Templates >
  System > Removable Storage Access >
  All Removable Storage: Deny all access = Enabled
  ```

**Priority 3 (Medium-term):**
- Deploy USB device whitelisting (USBGuard, Microsoft Defender)
- Implement EDR solution with USB monitoring
- Physical USB port locks for high-sensitivity areas

**Priority 4 (Long-term):**
- Security awareness training on physical security
- Clear desk policy enforcement
- Regular security audits

**References:**
- MITRE ATT&CK: T1200 (Hardware Additions)
- NIST SP 800-53: PE-3 (Physical Access Control)
- CIS Control 13: Data Protection
```

### Metriques et Statistiques

**Inclure dans le rapport:**

```
Physical Access Tests:
- Tailgating attempts: 10
- Successful: 8 (80%)
- Challenged by security: 2 (20%)

Workstation Security:
- Workstations observed: 50
- Unlocked/unattended: 15 (30%)
- USB ports accessible: 48 (96%)
- Auto-lock configured: 5 (10%)

HID Attack Success Rate:
- Attempts: 10
- Successful: 10 (100%)
- Detected by EDR: 0 (0%)
- Average execution time: 75 seconds

Recommendations Priority:
- Critical: 3
- High: 5
- Medium: 8
- Low: 4
```

---

## Defenses

### Controles Preventifs

#### 1. Controle d'Acces Physique

**Bonnes Pratiques:**
- Turnstiles/man-traps
- Badge + PIN/biometrie
- Visitors logged et escorted
- Anti-tailgating policies
- Security guards trained

#### 2. Workstation Security

**Configuration recommandee:**

**Windows:**
```powershell
# Auto-lock apres 5 minutes
Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name ScreenSaveTimeOut -Value 300
Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name ScreenSaveActive -Value 1
Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name ScreenSaverIsSecure -Value 1

# Disable USB storage via GPO
# Computer Configuration > Administrative Templates > System > Removable Storage Access
```

**Linux:**
```bash
# GNOME auto-lock
gsettings set org.gnome.desktop.session idle-delay 300
gsettings set org.gnome.desktop.screensaver lock-enabled true

# Disable USB storage
echo "blacklist usb-storage" >> /etc/modprobe.d/blacklist-usb.conf
```

#### 3. USB Port Control

**Options:**

**Software:**
- USBGuard (Linux) - whitelist approved devices
- Microsoft Defender Application Control
- Symantec Endpoint Protection
- McAfee Device Control

**Hardware:**
- USB port locks (physical)
- USB data blockers (charging only)
- Epoxy in unused ports

**Configuration USBGuard:**
```bash
# Install
apt install usbguard

# Allow currently connected devices
usbguard generate-policy > /etc/usbguard/rules.conf

# Start service
systemctl enable usbguard
systemctl start usbguard

# New devices will be blocked by default
```

#### 4. Endpoint Detection

**EDR Solutions:**
- CrowdStrike Falcon
- SentinelOne
- Microsoft Defender for Endpoint
- Carbon Black

**Detection Capabilities:**
- Unusually rapid keystrokes
- Suspicious command execution
- New USB device connections
- Unauthorized process spawning

### Controles de Detection

#### Monitoring

**Events a monitorer:**

**Windows Event Logs:**
```
Event ID 4624 - Logon
Event ID 4688 - Process Creation
Event ID 6416 - USB device connection
Event ID 2003/2004 - USB storage detection
```

**Linux Logs:**
```bash
# USB events
journalctl -k | grep -i usb

# Audit logs
ausearch -m USER_LOGIN

# Monitor USB
udevadm monitor --environment --udev
```

#### SIEM Rules

**Example Splunk Query:**
```
index=windows EventCode=4688 (CommandLine="*powershell*" OR CommandLine="*cmd.exe*")
| stats count by Computer, User, CommandLine
| where count > 5
```

### Awareness Training

**Topics a couvrir:**
- Physical security importance
- Tailgating risks
- USB device dangers
- Clean desk policy
- Reporting suspicious activity
- Screen lock best practices

**Simulations:**
- Fake USB drops (neutered devices)
- Tailgating tests (with notification)
- Phishing emails about physical security
- Regular reminders

---

## Conclusion

Le physical security testing est un element crucial d'une evaluation de securite complete. Les vulnerabilites physiques peuvent souvent contourner les controles techniques les plus avances.

**Points Cles:**
- TOUJOURS obtenir autorisation ecrite
- Documenter rigoureusement
- Approche professionnelle et ethique
- Focus sur recommendations constructives
- Formation du personnel = cle du succes

---

**Rappel Final:** L'acces physique non autorise est illegal et contraire a l'ethique professionnelle.
