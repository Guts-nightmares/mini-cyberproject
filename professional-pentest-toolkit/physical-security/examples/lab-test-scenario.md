# Scenario de Test - Laboratoire Personnel

Exemple complet d'utilisation des scripts HID dans votre laboratoire personnel.

## Objectif

Automatiser le diagnostic de vos machines de lab en utilisant un Flipper Zero.

## Setup

### Machines de Lab

- **VM-Ubuntu-01**: Ubuntu 22.04 LTS
- **VM-Windows-01**: Windows 11 Pro
- **MacBook-Lab**: macOS Sonoma

### Materiel

- Flipper Zero avec carte microSD
- Cable USB-C vers USB-A (si necessaire)

## Scenario 1: Test sur Ubuntu

### Preparation

```bash
# Sur VM-Ubuntu-01
# Copier le script de diagnostic
scp payloads/diagnostics/lab-diagnostic.sh user@vm-ubuntu-01:/tmp/
ssh user@vm-ubuntu-01 'chmod +x /tmp/lab-diagnostic.sh'

# Tester manuellement
ssh user@vm-ubuntu-01 '/tmp/lab-diagnostic.sh'
```

### Execution

1. **Deverrouiller VM-Ubuntu-01**
2. **Aller a un bureau vide**
3. **Sur Flipper Zero:**
   - Bad USB > lab-diagnostic-linux.txt > Press
4. **Brancher Flipper sur VM-Ubuntu-01**
5. **Observer:**
   - Terminal s'ouvre (via Ctrl+Alt+T)
   - Script s'execute
   - Resultats affiches

### Resultats Attendus

```
==========================================
SYSTEM DIAGNOSTIC REPORT
Generated: 2024-01-15 10:30:45
==========================================

=== BASIC INFORMATION ===
Hostname: vm-ubuntu-01
User: labuser
User ID: uid=1000(labuser) gid=1000(labuser) groups=1000(labuser)

=== OPERATING SYSTEM ===
NAME="Ubuntu"
VERSION="22.04.3 LTS (Jammy Jellyfish)"
...

[+] Report saved to: /tmp/lab-diagnostic-20240115-103045.txt
```

### Timing

- Terminal open: ~2 seconds
- Script execution: ~45 seconds
- Total: ~47 seconds

## Scenario 2: Test sur Windows

### Preparation

```powershell
# Sur VM-Windows-01
# Copier le script
Copy-Item \\lab-share\payloads\diagnostics\lab-diagnostic.ps1 -Destination $env:TEMP\diagnostic.ps1

# Tester
powershell -ExecutionPolicy Bypass $env:TEMP\diagnostic.ps1
```

### Execution

1. **Deverrouiller VM-Windows-01**
2. **Fermer applications**
3. **Sur Flipper:**
   - Bad USB > lab-diagnostic-windows.txt > Press
4. **Brancher Flipper**
5. **Observer PowerShell s'ouvrir et executer**

### Resultats Attendus

```
==========================================
SYSTEM DIAGNOSTIC REPORT
Generated: 01/15/2024 10:35:22
==========================================

=== BASIC INFORMATION ===
Computer Name: VM-WINDOWS-01
Username: labuser
Domain: WORKGROUP

=== OPERATING SYSTEM ===
OS Name: Microsoft Windows 11 Pro
Version: 10.0.22621
...

[+] Report saved to: C:\Users\labuser\AppData\Local\Temp\lab-diagnostic-20240115-103522.txt
[+] Report copied to clipboard
```

## Scenario 3: Enumeration Rapide

### Objectif

Collecter rapidement des informations systeme basiques sans script pre-installe.

### Execution

1. **Sur Flipper:**
   - Bad USB > system-enum-basic.txt > Press
2. **Brancher sur n'importe quelle machine de lab**
3. **Script cree /tmp/enum.txt avec:**
   - Hostname
   - Username
   - OS info
   - IP addresses

### Code du Script

Le script Flipper execute directement:
```bash
echo "=== System Enumeration ===" > /tmp/enum.txt
echo "Hostname: $(hostname)" >> /tmp/enum.txt
echo "User: $(whoami)" >> /tmp/enum.txt
echo "OS: $(uname -a)" >> /tmp/enum.txt
ip addr | grep inet >> /tmp/enum.txt
cat /tmp/enum.txt
```

### Utilite

- Verification rapide de machine inconnue
- Pas besoin de script pre-installe
- Ideal pour lab avec machines ephemeres

## Scenario 4: Integration avec Toolkit

### Workflow Complet

```bash
# 1. Initialiser session de test
cd professional-pentest-toolkit

python utilities/engagement-logger.py --start "Lab-Testing-Jan2024" \
    --client "Personal Lab" \
    --scope "HID automation testing on lab VMs"

# 2. Tester sur Ubuntu
# (brancher Flipper, executer script)

python utilities/engagement-logger.py --log "HID test on Ubuntu VM" \
    --category physical-security \
    --target "VM-Ubuntu-01" \
    --details "Script executed in 47s, diagnostic completed successfully"

# 3. Tester sur Windows
# (brancher Flipper, executer script)

python utilities/engagement-logger.py --log "HID test on Windows VM" \
    --category physical-security \
    --target "VM-Windows-01" \
    --details "PowerShell script executed, all checks passed"

# 4. Generer rapport
python utilities/engagement-logger.py --report

# 5. Terminer
python utilities/engagement-logger.py --end
```

### Rapport Generate

```
=== ENGAGEMENT LOG: Lab-Testing-Jan2024 ===
Started: 2024-01-15T10:00:00

[2024-01-15 10:30:45] [PHYSICAL-SECURITY] [Target: VM-Ubuntu-01]
HID test on Ubuntu VM
  Details: Script executed in 47s, diagnostic completed successfully

[2024-01-15 10:45:12] [PHYSICAL-SECURITY] [Target: VM-Windows-01]
HID test on Windows VM
  Details: PowerShell script executed, all checks passed

Engagement termine: 2024-01-15T11:00:00
```

## Scenario 5: Personnalisation

### Creer un Script Custom

**Objectif:** Verifier si Docker est installe et running

**Fichier:** `hid-scripts/flipper-zero/docker-check.txt`

```
REM Docker Check Script
REM Lab use only

DELAY 1000
GUI SPACE
DELAY 500
STRING terminal
DELAY 500
ENTER
DELAY 1500

REM Check Docker
STRING docker --version && docker ps
ENTER
DELAY 2000

REM Optional: start container
REM STRING docker run hello-world
REM ENTER
```

### Payload Custom

**Fichier:** `payloads/diagnostics/docker-diagnostic.sh`

```bash
#!/bin/bash
echo "=== Docker Diagnostic ==="
echo "Docker version: $(docker --version 2>/dev/null || echo 'Not installed')"
echo "Running containers:"
docker ps 2>/dev/null || echo "Docker not running or not accessible"
echo ""
echo "Docker images:"
docker images 2>/dev/null | head -10
```

## Metriques et Mesures

### Performance

| Test | Machine | Temps Total | Succes |
|------|---------|-------------|--------|
| Diagnostic complet | Ubuntu VM | 47s | Oui |
| Diagnostic complet | Windows VM | 52s | Oui |
| Enum basique | macOS | 12s | Oui |
| Docker check | Ubuntu VM | 8s | Oui |

### Observations

- **Timing critique:** DELAY doit etre adapte a la vitesse de la machine
- **Keyboard layout:** US layout fonctionne sur toutes machines de lab
- **Terminal:** Ctrl+Alt+T plus fiable que GUI+recherche sur Linux
- **Cleanup:** Scripts creent fichiers temporaires, penser a nettoyer

## Troubleshooting Lab

### Probleme: Script ne trouve pas le fichier

**Symptome:**
```
bash: /tmp/lab-diagnostic.sh: No such file or directory
```

**Solution:**
```bash
# Re-copier le script
scp payloads/diagnostics/lab-diagnostic.sh user@vm:/tmp/
ssh user@vm 'chmod +x /tmp/lab-diagnostic.sh'
```

### Probleme: Terminal ne s'ouvre pas

**Symptome:** Flipper execute mais rien ne se passe

**Solution:**
- Verifier keyboard layout (US vs AZERTY)
- Augmenter DELAY
- Tester manuellement le raccourci clavier

### Probleme: Execution trop rapide

**Symptome:** Commandes manquees ou erreurs

**Solution:**
```
# Dans le script Flipper, augmenter DELAY
DELAY 1000 -> DELAY 2000
DELAY 500 -> DELAY 1000
```

## Prochaines Etapes

### Optimisations

1. **Scripts multi-plateforme:**
   - Detecter OS automatiquement
   - Adapter commandes selon plateforme

2. **Integration reseau:**
   - Uploader resultats vers serveur
   - Notification Discord/Slack

3. **Reporting automatise:**
   - Parser output des diagnostics
   - Generer rapport HTML

### Extensions

1. **Vulnerability scanning:**
   - Lancer LinPEAS automatiquement
   - Executer scans Nmap locaux

2. **Configuration compliance:**
   - Verifier hardening
   - Comparer avec baseline

3. **Inventory management:**
   - Collecter hardware info
   - Maintenir inventaire de lab

## Conclusion

Les scripts HID sont excellents pour:
- Automatisation dans votre lab
- Apprentissage des techniques
- Preparation avant engagements clients
- Tests de securite physique

**Toujours dans un cadre legal et ethique!**
