# Physical Security Testing Framework

Framework professionnel pour tests de securite physique incluant scripts HID, automatisation de diagnostic, et evaluation de postes de travail.

## Avertissement Legal

**USAGE STRICTEMENT LIMITE A:**
- Votre propre laboratoire personnel
- Engagements de physical security avec autorisation ECRITE
- Tests sur VOS PROPRES machines
- Demonstrations educatives dans environnement controle
- Red team exercises avec scope defini incluant physical access

**INTERDIT:**
- Usage sur machines non autorisees
- Deploiement sans autorisation explicite
- Tests "surprises" sans accord du client
- Laisser des dispositifs HID non surveilles

## Vue d'ensemble

### Qu'est-ce qu'un dispositif HID?

HID (Human Interface Device) = peripherique qui emule un clavier/souris.

**Exemples:**
- Flipper Zero
- USB Rubber Ducky
- Bash Bunny
- Digispark/Arduino
- O.MG Cable

**Principe:**
1. Peripherique branche en USB
2. Detecte comme clavier par l'OS
3. Execute des frappes clavier automatiques
4. Peut ouvrir terminal et executer commandes

## Structure du Framework

```
physical-security/
├── hid-scripts/           # Scripts pour differents dispositifs
│   ├── flipper-zero/      # Scripts Flipper Zero (.txt)
│   ├── rubber-ducky/      # Scripts Ducky Script
│   └── digispark/         # Scripts Arduino/Digispark
├── payloads/              # Payloads a executer
│   ├── diagnostics/       # Scripts de diagnostic
│   ├── enumeration/       # Enumeration locale
│   └── reporting/         # Collecte d'informations
├── documentation/
│   └── physical-pentest-methodology.md
└── README.md              # Ce fichier
```

## Cas d'Usage Legitimes

### 1. Laboratoire Personnel

**Scenario:** Automatiser des taches repetitives dans votre lab

```
Flipper Zero → Ouvre terminal → Execute diagnostic
```

**Exemples:**
- Lancer LinPEAS automatiquement
- Collecter informations systeme
- Tester scripts de remediation
- Benchmark de securite

### 2. Physical Security Assessment (Autorise)

**Scenario:** Engagement client pour tester securite physique

**Avec autorisation ecrite incluant:**
- Physical access testing autorise
- Liste des emplacements accessibles
- Fenetres de test definies
- Procedures d'escalade

**Tests:**
- Acces non autorise aux postes
- USB ports non proteges
- Ecrans deverrouilles
- Auto-lock timeout

### 3. Security Awareness Training

**Scenario:** Demonstration pour formation employees

**Avec accord du client:**
- Formation planifiee
- Demonstration controlee
- Debriefing immediat
- Objectifs pedagogiques clairs

### 4. Red Team Exercise

**Scenario:** Exercice red team complet

**Avec scope incluant:**
- Physical intrusion autorisee
- Social engineering permis
- Objectifs definis (flag, acces, etc.)
- Rules of engagement claires

## Scripts HID Professionnels

### Script 1: Diagnostic System Simple

**Objectif:** Ouvrir terminal et lancer script de diagnostic local

**Flipper Zero (flipper-diagnostic.txt):**
```
REM Diagnostic System Script
REM Target: Lab machines (Linux/macOS)
REM Action: Open terminal, run local diagnostic

DELAY 1000
GUI SPACE
DELAY 500
STRING terminal
DELAY 500
ENTER
DELAY 1000

REM Execute local diagnostic script
STRING bash /tmp/lab-diagnostic.sh
ENTER
```

**Windows version:**
```
REM Windows Diagnostic
DELAY 1000
GUI r
DELAY 500
STRING powershell -ExecutionPolicy Bypass
ENTER
DELAY 1000
STRING cd $env:TEMP
ENTER
STRING .\diagnostic.ps1
ENTER
```

### Script 2: Enumeration Locale (Non-Invasive)

**Objectif:** Collecter informations systeme basiques

**Rubber Ducky Script:**
```
REM System Information Gathering
REM Non-invasive enumeration only

DELAY 1000
GUI r
DELAY 300
STRING cmd
ENTER
DELAY 500

REM Basic system info
STRING systeminfo > %TEMP%\sysinfo.txt
ENTER
DELAY 2000
STRING ipconfig /all >> %TEMP%\sysinfo.txt
ENTER
DELAY 1000
STRING net user >> %TEMP%\sysinfo.txt
ENTER
DELAY 1000

REM Open results
STRING notepad %TEMP%\sysinfo.txt
ENTER
```

### Script 3: Network Information

**Objectif:** Informations reseau pour evaluation

```
REM Network Enumeration
DELAY 1000
CTRL-ALT t
DELAY 1000

STRING ip addr > /tmp/network-info.txt
ENTER
DELAY 500
STRING route -n >> /tmp/network-info.txt
ENTER
DELAY 500
STRING cat /etc/resolv.conf >> /tmp/network-info.txt
ENTER
DELAY 500
STRING cat /tmp/network-info.txt
ENTER
```

## Payloads de Diagnostic

Ces scripts sont executes PAR les scripts HID.

### diagnostic-linux.sh

Voir: `payloads/diagnostics/diagnostic-linux.sh`

### diagnostic-windows.ps1

Voir: `payloads/diagnostics/diagnostic-windows.ps1`

## Bonnes Pratiques

### Avant un Engagement

1. **Autorisation Ecrite Explicite**
   ```
   Le contrat doit inclure:
   - "Physical security testing is authorized"
   - Emplacements specifiques autorises
   - Periode de test
   - Scope des actions physiques
   ```

2. **Briefing avec le Client**
   - Expliquer les techniques utilisees
   - Definir les limites
   - Etablir communication d'urgence
   - Preparer badges/authorizations

3. **Preparation Technique**
   - Tester scripts dans votre lab
   - Preparer versions multi-OS
   - Avoir des fallbacks
   - Documenter chaque script

### Pendant un Engagement

1. **Discretion Professionnelle**
   - Ne pas attirer l'attention
   - Respecter les employes
   - Documenter en temps reel
   - Communiquer avec le contact client

2. **Safety First**
   - Ne jamais forcer l'acces physique
   - Respecter les zones restreintes
   - Arreter si situation ambigue
   - Escalader au contact client si doute

3. **Documentation**
   ```bash
   # Logger chaque action
   python utilities/engagement-logger.py --log "Physical access test" \
       --category physical-security \
       --target "Building A, Floor 2" \
       --details "USB port accessible, screen unlocked"
   ```

### Apres un Engagement

1. **Cleanup**
   - Recuperer tous les dispositifs
   - Supprimer logs/fichiers crees
   - Verifier aucun artefact laisse

2. **Reporting**
   ```bash
   python reporting/report-generator.py --add-finding \
       --title "Unattended workstations with USB ports enabled" \
       --severity high \
       --description "Multiple workstations found unlocked with USB ports accessible" \
       --impact "Attacker could execute malicious code via HID attack" \
       --remediation "Implement: USB port controls, automatic screen lock, security awareness training"
   ```

## Defenses Contre les Attaques HID

### Techniques de Prevention

1. **USB Port Control**
   ```bash
   # Linux: Bloquer USB storage
   echo "blacklist usb-storage" >> /etc/modprobe.d/blacklist-usb.conf

   # Windows: Group Policy
   # Computer Configuration > Administrative Templates > System >
   # Removable Storage Access > All Removable Storage: Deny all access
   ```

2. **Automatic Screen Lock**
   ```bash
   # Linux (GNOME)
   gsettings set org.gnome.desktop.session idle-delay 300
   gsettings set org.gnome.desktop.screensaver lock-enabled true

   # Windows: Group Policy
   # Inactivity timeout: 5 minutes
   ```

3. **USB Device Whitelisting**
   - USBGuard (Linux)
   - Microsoft Defender Application Control (Windows)
   - Endpoint security solutions

4. **Physical Security**
   - Cable locks pour workstations
   - USB port locks physiques
   - BIOS password protection
   - Disable boot from USB

### Detection

1. **Monitoring**
   ```bash
   # Linux: Monitor USB events
   udevadm monitor --environment --udev

   # Syslog monitoring
   tail -f /var/log/syslog | grep -i usb
   ```

2. **EDR Solutions**
   - CrowdStrike
   - SentinelOne
   - Microsoft Defender for Endpoint

   Peuvent detecter:
   - Frappe clavier anormalement rapide
   - Execution de commandes suspectes
   - Nouveaux peripheriques USB

## Testing Methodology

### Phase 1: Reconnaissance Physique

- [ ] Observer le site
- [ ] Identifier points d'acces
- [ ] Noter les controles de securite
- [ ] Reperer workstations non surveillees
- [ ] Documenter cameras, gardes, badges

### Phase 2: Preparation

- [ ] Preparer scripts HID adaptes
- [ ] Tester dans environnement similaire
- [ ] Preparer couverture/pretexte (si autorise)
- [ ] Briefing avec contact client
- [ ] Verifier equipement

### Phase 3: Execution

- [ ] Respecter la fenetre de test
- [ ] Approche discrete
- [ ] Execution rapide du test
- [ ] Documentation immediate
- [ ] Communication si anomalie

### Phase 4: Documentation

- [ ] Photos (si autorise)
- [ ] Timestamps precis
- [ ] Description detaillee
- [ ] Impact evaluation
- [ ] Recommandations

## Outils et Materiel

### Dispositifs HID Recommandes

| Dispositif | Prix | Avantages | Inconvenients |
|------------|------|-----------|---------------|
| Flipper Zero | ~150€ | Multi-usage, portable | Connaissance requise |
| USB Rubber Ducky | ~60€ | Simple, efficace | Mono-usage |
| Bash Bunny | ~120€ | Puissant, stockage | Plus visible |
| Digispark | ~5€ | Tres discret, cheap | Programmation Arduino |
| O.MG Cable | ~200€ | Tres furtif | Tres cher |

### Outils Complementaires

- **Lockpicking kit** (si autorise explicitement)
- **Badge cloner** (legal testing only)
- **Camera cachee** (avec autorisation)
- **Social engineering toolkit**

## Formation et Certification

### Certifications Pertinentes

- **OSEP** - Offensive Security Experienced Penetration Tester
- **PNPT** - Practical Network Penetration Tester (inclut physical)
- **GPEN** - GIAC Penetration Tester
- **Physical Penetration Tester** (divers organismes)

### Ressources d'Apprentissage

- **Hak5 YouTube Channel** - Tutoriels Rubber Ducky, Bash Bunny
- **Seytonic YouTube** - Flipper Zero, physical security
- **The Cyber Mentor** - Red team physical security
- **SANS SEC560** - Network Penetration Testing (inclut physical)

## Exemples de Rapports

### Finding Example: Unlocked Workstation

```markdown
## Finding: Unattended Workstations Vulnerable to HID Attacks

**Severity:** HIGH (CVSS 7.5)

**Description:**
During physical security testing on Floor 2, Building A, 8 out of 12
workstations were found unlocked and unattended during business hours.
USB ports were accessible and functional.

**Proof of Concept:**
Using an authorized HID device (Flipper Zero), the testing team
successfully:
1. Connected device to USB port
2. Opened terminal via automated keystrokes
3. Executed system enumeration commands
4. Collected system information

Total time: 45 seconds

**Impact:**
An attacker with brief physical access could:
- Install malware
- Exfiltrate sensitive data
- Create backdoor accounts
- Escalate privileges
- Establish persistence

**Affected Systems:**
- Floor 2, Building A: 8 workstations
- Department: Finance and HR

**Remediation:**
1. IMMEDIATE: Enforce automatic screen lock (5 min timeout)
2. SHORT-TERM: Disable unnecessary USB ports via Group Policy
3. MEDIUM-TERM: Deploy USB device whitelisting
4. ONGOING: Security awareness training on physical security
5. TECHNICAL: Deploy EDR solution with USB monitoring

**References:**
- MITRE ATT&CK: T1200 (Hardware Additions)
- NIST 800-53: PE-3 (Physical Access Control)
```

## Integration avec le Toolkit

### Logging Physical Tests

```bash
# Demarrer un engagement physical security
python utilities/engagement-logger.py --start "PhysSec-Client-2024" \
    --client "ACME Corp" \
    --scope "Physical security assessment - Building A, Floors 1-3"

# Logger chaque test
python utilities/engagement-logger.py --log "HID attack successful on workstation" \
    --category physical-security \
    --target "Building A, Floor 2, Desk 23" \
    --severity high \
    --details "Unlocked workstation, USB accessible, no EDR detection"

# Ajouter au rapport
python reporting/report-generator.py --add-finding \
    --title "USB HID Attack Vector - Unprotected Workstations" \
    --severity high \
    --cvss "7.5"
```

## Legal et Ethique

### Cadre Legal

**En France:**
- Code Penal Art. 323-1: Acces frauduleux a un STAD
- **Exception:** Autorisation ecrite du proprietaire
- **Requis:** Contrat explicite mentionnant physical testing

**International:**
- Computer Fraud and Abuse Act (USA)
- Computer Misuse Act (UK)
- Toujours verifier legislation locale

### Ethique Professionnelle

1. **Transparence avec le client**
   - Techniques utilisees
   - Risques potentiels
   - Scope precis

2. **Respect des employes**
   - Ne pas traumatiser
   - Debriefing educatif
   - Approche constructive

3. **Securite avant tout**
   - Ne pas endommager
   - Ne pas exposer a des risques
   - Procedures d'urgence

## Conclusion

Les tests de securite physique avec dispositifs HID sont un outil puissant pour:
- Evaluer la posture de securite globale
- Identifier gaps de securite physique
- Former les employes
- Ameliorer les defenses

**Mais doivent TOUJOURS etre:**
- Autorises par ecrit
- Executes professionnellement
- Documentes rigoureusement
- Suivis de recommandations constructives

---

**Rappel:** L'usage non autorise de ces techniques est illegal et contraire a l'ethique.
